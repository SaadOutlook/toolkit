<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL.js Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
</head>
<body>

    <h1>Search Database</h1>

    <!-- Form for user input -->
    <form id="queryForm">
        <label for="usecase">Choose a usecase</label>
        <select id="usecase" name="usecase">
            <option value="usecase_apimanagement">API Management</option>
            <option value="usecase_artificialintelligence">Artificial Intelligence</option>
            <option value="usecase_automateddataextraction">Automated Data Extraction</option>
        </select>
        <br><br>
        <p>Select your Usecases:</p>
        <label>
            <input type="checkbox" name="options" value="usecase_apimanagement">
            API Management
        </label><br>
        <label>
            <input type="checkbox" name="options" value="usecase_artificialintelligence">
            Artificial Intelligence
        </label><br>
        <label>
            <input type="checkbox" name="options" value="usecase_automateddataextraction">
            Automated Data Extraction
        </label><br>
       <br>
     
        
        
        <input type="submit" value="Search">
    </form>
    
    <!-- Div to display the query results -->
    <div id="output"></div>

<script>
    // Initialize SQL.js and load the database
    async function loadDatabase() {
        const SQL = await initSqlJs({
            locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}`
        });

        // Fetch the SQLite database file
        const response = await fetch('articles.db');
        const arrayBuffer = await response.arrayBuffer();
        const db = new SQL.Database(new Uint8Array(arrayBuffer));

        return db;
    }

    // Function to execute the query and display results
    async function executeQuery(db, column, selCols) {
        const conditions = selCols.map(selCol => `${selCol} > 0.9`).join(' AND ');
        const query = `SELECT title FROM data WHERE ${conditions} LIMIT 10;`;
        // const stmt = db.prepare(query);
        // stmt.bind([value]);

        // const results = [];
        // while (stmt.step()) {
        //     results.push(stmt.getAsObject());
        // }
        // stmt.free();
        results = db.exec(query)
        return results;
    }

    document.getElementById('queryForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        // Get user input
        const column = document.getElementById('usecase').value;
        const checkboxes = document.querySelectorAll('input[name="options"]:checked');
            const selectedValues = [];

            // Iterate through the checked checkboxes and store their values
            checkboxes.forEach((checkbox) => {
                selectedValues.push(checkbox.value);
            });

        // Load the database and execute the query
        const db = await loadDatabase();
        const res = await executeQuery(db, column, selectedValues);

        // Display the results
        const outputDiv = document.getElementById('output');
        outputDiv.innerHTML = '';

        if (res.length > 0) {
                const columns = res[0].columns;
                const values = res[0].values;

                // Create a table to display the results
                let table = '<table border="1"><tr>';
                columns.forEach(col => {
                    table += `<th>${col}</th>`;
                });
                table += '</tr>';

                values.forEach(row => {
                    table += '<tr>';
                    row.forEach(val => {
                        table += `<td>${val}</td>`;
                    });
                    table += '</tr>';
                });

                table += '</table>';
                outputDiv.innerHTML = table;
            } else {
                outputDiv.innerHTML = 'No data found';
            }
    });

    // Load the database when the page is loaded
    window.onload = loadDatabase;
</script>

</body>
</html>